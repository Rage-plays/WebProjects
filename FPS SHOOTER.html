<html><head><base href="."><meta charset="UTF-8"><title>Zombie Survival - Top Down Shooter with Mystery Box</title><style>body {margin: 0;overflow: hidden;background: #111;font-family: Arial, sans-serif;}#gameCanvas {background: #1a1a1a; position: fixed; top: 0; left: 0; width: 100%; height: 100%;}#ui {position: fixed;top: 10px;left: 10px;color: #fff;font-size: 20px;text-shadow: 2px 2px 2px #000;}#gameOver {display: none;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);color: #ff0000;font-size: 48px;text-align: center;text-shadow: 2px 2px 4px #000;}#mysteryBoxPrompt {display: none;position: fixed;bottom: 20px;left: 50%;transform: translateX(-50%);color: #fff;font-size: 24px;text-shadow: 2px 2px 2px #000;background: rgba(0, 0, 0, 0.7);padding: 10px 20px;border-radius: 5px;}#currentWeapon {position: fixed;bottom: 20px;right: 20px;color: #fff;font-size: 20px;text-shadow: 2px 2px 2px #000;}#waveCount {position: fixed;bottom: 20px;left: 20px;color: #ff0000;font-size: 24px;text-shadow: 2px 2px 2px #000;}#score, #health {display: block;}#leaderboard {display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 20px; border-radius: 10px; color: white; min-width: 300px;}#juggernogPrompt {display: none;position: fixed;bottom: 20px;left: 50%;transform: translateX(-50%);color: #fff;font-size: 24px;text-shadow: 2px 2px 2px #000;background: rgba(0, 0, 0, 0.7);padding: 10px 20px;border-radius: 5px;}#doubleTapPrompt {display: none;position: fixed;bottom: 20px;left: 50%;transform: translateX(-50%);color: #fff;font-size: 24px;text-shadow: 2px 2px 2px #000;background: rgba(0, 0, 0, 0.7);padding: 10px 20px;border-radius: 5px;}#mainMenu {position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.9);display: flex;flex-direction: column;justify-content: center;align-items: center;z-index: 100;} .menuTitle {color: #ff0000;font-size: 64px;margin-bottom: 40px;text-shadow: 3px 3px 6px #000;} .menuButton {background: #ff0000;color: white;border: none;padding: 15px 30px;font-size: 24px;margin: 10px;cursor: pointer;border-radius: 5px;transition: transform 0.2s;} .menuButton:hover {transform: scale(1.1);} .menu {position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.9);display: flex;flex-direction: column;justify-content: center;align-items: center;z-index: 100;} .mapOptions {display: flex;gap: 20px;} .mapOption {background: rgba(255, 0, 0, 0.2);padding: 20px;border-radius: 10px;cursor: pointer;transition: transform 0.2s;} .mapOption:hover {transform: scale(1.05);background: rgba(255, 0, 0, 0.3);} .mapOption h2 {color: #ff0000;margin: 0 0 10px 0;} .mapOption p {color: white;margin: 0;}</style></head><body><canvas id="gameCanvas"></canvas><div id="ui"><span id="score">500</span><span id="health">100</span><span id="waveCount" style="font-size: 48px;">1</span></div><div id="mysteryBoxPrompt">Press 'E' to open Mystery Box (950 points)</div><div id="juggernogPrompt">Press 'E' to buy Juggernog (2500 points)</div><div id="doubleTapPrompt">Press 'E' to buy Double Tap 2.0 (2000 points)</div><div id="currentWeapon">Current Weapon: Pistol | Ammo: 12/12</div><div id="gameOver" style="left: 20px; transform: translateY(-50%);">GAME OVER<br>Final Score: <span id="finalScore">0</span><br><button id="restartButton">Play Again</button></div><div id="leaderboard" style="right: 20px; left: auto; transform: translateY(-50%);"><h2 style="text-align: center; color: #ff0000;">Top Waves Survived</h2><div id="leaderboardEntries" style="margin-top: 20px;"></div></div><div id="mainMenu"><h1 class="menuTitle">Call of Duty Zombies</h1><button class="menuButton" id="playButton">Play Game</button><button class="menuButton" id="howToPlayButton">How To Play</button></div><div id="mapSelect" style="display: none;" class="menu"><h1 class="menuTitle">Select Map</h1><div class="mapOptions"><div class="mapOption" data-map="CLASSIC"><h2>Classic Map</h2><p>The original zombie survival experience</p></div><div class="mapOption" data-map="ARENA"><h2>Arena</h2><p>Squared arena with multiple entry points</p></div><div class="mapOption" data-map="MULTIPLAYER"><h2>Multiplayer</h2><p>Play together online with other players</p></div></div></div><script>const canvas = document.getElementById("gameCanvas");function resizeCanvas() {canvas.width = window.innerWidth;canvas.height = window.innerHeight;}resizeCanvas();const ctx = canvas.getContext("2d");const room = new WebsimSocket();let otherPlayers = new Map();let currentMenu = 'main';let selectedMap = null;function resizeCanvas() {canvas.width = window.innerWidth;canvas.height = window.innerHeight;}const WEAPONS = {PISTOL: {name: "Pistol",damage: 1,fireRate: 250,bulletSpeed: 10,bulletSize: 5,color: "#ffff00",maxAmmo: 12,reloadTime: 1000},SHOTGUN: {name: "Shotgun",damage: 1,fireRate: 500,bulletSpeed: 8,bulletSize: 4,pellets: 8,spread: 0.3,color: "#ff9900",maxAmmo: 8,reloadTime: 2000},RIFLE: {name: "Rifle",damage: 2,fireRate: 100,bulletSpeed: 15,bulletSize: 3,color: "#ff0000",maxAmmo: 30,reloadTime: 1500},RAY_GUN: {name: "Ray Gun",damage: 5,fireRate: 300,bulletSpeed: 12,bulletSize: 8,color: "#00ff00",maxAmmo: 20,reloadTime: 2000},MINIGUN: {name: "Minigun",damage: 1,fireRate: 50,bulletSpeed: 12,bulletSize: 4,color: "#ff00ff",maxAmmo: 100,reloadTime: 3000}};let doorConfig = [ {x: 900,y: 500,width: 100,height: 20,isOpen: false,cost: 1500,wallIndex: 4}, {x: 1500,y: 500,width: 20,height: 100,isOpen: false,cost: 1500,wallIndex: 5}, {x: 800,y: 1700,width: 20,height: 100,isOpen: false,cost: 1500,wallIndex: 12}];const mapConfig = {walls: [ {x: 100,y: 100,width: 2800,height: 20}, {x: 100,y: 2880,width: 2800,height: 20}, {x: 100,y: 100,width: 20,height: 2800}, {x: 2880,y: 100,width: 20,height: 2800}, {x: 500,y: 500,width: 800,height: 20}, {x: 500,y: 500,width: 20,height: 500}, {x: 1300,y: 500,width: 20,height: 500}, {x: 500,y: 1000,width: 820,height: 20}, {x: 1500,y: 300,width: 600,height: 20}, {x: 1500,y: 300,width: 20,height: 400}, {x: 2100,y: 300,width: 20,height: 400}, {x: 1500,y: 700,width: 620,height: 20}, {x: 800,y: 1500,width: 700,height: 20}, {x: 800,y: 1500,width: 20,height: 400}, {x: 1500,y: 1500,width: 20,height: 400}, {x: 800,y: 1900,width: 720,height: 20}],spawnPoints: [ {x: 200,y: 200}, {x: 2800,y: 200}, {x: 200,y: 2800}, {x: 2800,y: 2800}, {x: 200,y: 1500}, {x: 2800,y: 1500}, {x: 1500,y: 150}, {x: 1500,y: 2850} ]};const MAPS = {CLASSIC: {name: 'Classic Map',description: 'The original zombie survival experience',walls: mapConfig.walls,spawnPoints: mapConfig.spawnPoints,doors: doorConfig},ARENA: {name: 'Arena',description: 'Circular arena with multiple entry points',walls: [ {x: 100, y: 100, width: 2800, height: 20},{x: 100, y: 2880, width: 2800, height: 20},{x: 100, y: 100, width: 20, height: 2800},{x: 2880, y: 100, width: 20, height: 2800},{x: 1200, y: 1200, width: 600, height: 20},{x: 1200, y: 1800, width: 600, height: 20},{x: 1200, y: 1200, width: 20, height: 600},{x: 1800, y: 1200, width: 20, height: 600},],spawnPoints: [ {x: 200, y: 200},{x: 2800, y: 200},{x: 200, y: 2800},{x: 2800, y: 2800}],doors: [ {x: 1500, y: 1200, width: 100, height: 20, isOpen: false, cost: 1000, wallIndex: 4},{x: 1200, y: 1500, width: 20, height: 100, isOpen: false, cost: 1000, wallIndex: 6}]},MULTIPLAYER: {name: 'Multiplayer',description: 'Play together online with other players',walls: [ {x: 100, y: 100, width: 2800, height: 20}, {x: 100, y: 2880, width: 2800, height: 20}, {x: 100, y: 100, width: 20, height: 2800}, {x: 2880, y: 100, width: 20, height: 2800}],spawnPoints: [ {x: 200, y: 200}, {x: 2800, y: 200}, {x: 200, y: 2800}, {x: 2800, y: 2800}],doors: []}};let gameState = {player: {x: 300,y: 300,size: 30,speed: 5,health: 100,currentWeapon: WEAPONS.PISTOL,lastShot: 0,ammo: WEAPONS.PISTOL.maxAmmo,isReloading: false, reloadStartTime: 0},zombies: [],bullets: [],doors: [...doorConfig],wave: 1,score: 500,gameOver: false,mysteryBox: {x: 900,y: 700,width: 90,height: 40,isOpen: false,animationStart: 0,currentWeapon: null},juggernog: {x: 1700,y: 400,width: 40,height: 40,active: true,used: false},doubleTap: {x: 1200,y: 700,width: 40,height: 40,active: true,used: false},worldWidth: 3000,worldHeight: 3000};let mouse = {x: 0,y: 0};let keys = {};let gameStarted = false;window.addEventListener("keydown", e => {keys[e.key] = true;if (e.key.toLowerCase() === "e") {tryOpenMysteryBox();tryOpenDoor();tryBuyJuggernog();tryBuyDoubleTap();}if (e.key.toLowerCase() === "r") {tryReload();}});window.addEventListener("keyup", e => keys[e.key] = false);canvas.addEventListener("mousemove", e => {mouse.x = e.clientX + (gameState.player.x - window.innerWidth / 2);mouse.y = e.clientY + (gameState.player.y - window.innerHeight / 2);});canvas.addEventListener("click", shootBullet);document.getElementById("playButton").addEventListener("click", () => {currentMenu = 'mapSelect';document.getElementById("mainMenu").style.display = "none";document.getElementById("mapSelect").style.display = "flex";});document.getElementById("howToPlayButton").addEventListener("click", () => {alert(`How to Play:\n- WASD or Arrow Keys to move\n- Mouse to aim and shoot\n- Press E to interact with:\n  - Mystery Box (950 points)\n  - Doors (1500 points)\n  - Juggernog (2500 points)\n  - Double Tap 2.0 (2000 points)\n- Press R to reload when out of ammo\n- Survive as many waves as possible!`);});document.querySelectorAll('.mapOption').forEach(option => {option.addEventListener('click', () => {selectedMap = option.dataset.map;const selectedMapConfig = MAPS[selectedMap];mapConfig.walls = selectedMapConfig.walls;mapConfig.spawnPoints = selectedMapConfig.spawnPoints;doorConfig = [...selectedMapConfig.doors];currentMenu = 'playing';document.getElementById("mapSelect").style.display = "none";gameStarted = true;if (selectedMap === 'MULTIPLAYER') {room.party.client.host = otherPlayers.size === 0;}resetGame();});});function syncZombies() {if (selectedMap === 'MULTIPLAYER') {room.send({type: "zombieSync",zombies: gameState.zombies,wave: gameState.wave});}}function broadcastZombieKill(zombieIndex, killerScore) {if (selectedMap === 'MULTIPLAYER') {room.send({type: "zombieKilled",index: zombieIndex,score: killerScore});}}function tryReload() {if (!gameState.player.isReloading && gameState.player.ammo < gameState.player.currentWeapon.maxAmmo) {gameState.player.isReloading = true;gameState.player.reloadStartTime = Date.now();setTimeout(() => {gameState.player.ammo = gameState.player.currentWeapon.maxAmmo;gameState.player.isReloading = false;}, gameState.player.currentWeapon.reloadTime);}}function tryOpenMysteryBox() {if (gameState.score >= 950) {const dx = gameState.player.x - gameState.mysteryBox.x;const dy = gameState.player.y - gameState.mysteryBox.y;const distance = Math.sqrt(dx * dx + dy * dy);if (distance < 100 && !gameState.mysteryBox.isOpen) {gameState.score -= 950;openMysteryBox();}}}function tryOpenDoor() {for (let door of gameState.doors) {if (door.isOpen) continue;const dx = gameState.player.x - (door.x + door.width / 2);const dy = gameState.player.y - (door.y + door.height / 2);const distance = Math.sqrt(dx * dx + dy * dy);if (distance < 100 && gameState.score >= door.cost) {door.isOpen = true;gameState.score -= door.cost;mapConfig.walls.splice(door.wallIndex, 1);for (let otherDoor of gameState.doors) {if (otherDoor.wallIndex > door.wallIndex) {otherDoor.wallIndex--;}}}}}function tryBuyJuggernog() {if (gameState.score >= 2500 && !gameState.juggernog.used) {const dx = gameState.player.x - gameState.juggernog.x;const dy = gameState.player.y - gameState.juggernog.y;const distance = Math.sqrt(dx * dx + dy * dy);if (distance < 100) {gameState.score -= 2500;gameState.player.health = 200;gameState.juggernog.used = true;}}}function tryBuyDoubleTap() {if (gameState.score >= 2000 && !gameState.doubleTap.used) {const dx = gameState.player.x - gameState.doubleTap.x;const dy = gameState.player.y - gameState.doubleTap.y;const distance = Math.sqrt(dx * dx + dy * dy);if (distance < 100) {gameState.score -= 2000;Object.values(WEAPONS).forEach(weapon => {weapon.damage *= 2;weapon.fireRate = Math.floor(weapon.fireRate / 2);});gameState.doubleTap.used = true;}}}function openMysteryBox() {gameState.mysteryBox.isOpen = true;gameState.mysteryBox.animationStart = Date.now();const weapons = Object.values(WEAPONS).filter(w => w !== gameState.player.currentWeapon);const randomWeapon = weapons[Math.floor(Math.random() * weapons.length)];gameState.mysteryBox.currentWeapon = randomWeapon;setTimeout(() => {gameState.player.currentWeapon = randomWeapon;gameState.player.ammo = randomWeapon.maxAmmo;document.getElementById("currentWeapon").textContent = `Current Weapon: ${randomWeapon.name} | Ammo: ${gameState.player.ammo}/${randomWeapon.maxAmmo}`;gameState.mysteryBox.isOpen = false;gameState.mysteryBox.currentWeapon = null;}, 3000);}function shootBullet() {if (gameState.gameOver || gameState.player.isReloading || gameState.player.ammo <= 0) return;const now = Date.now();if (now - gameState.player.lastShot < gameState.player.currentWeapon.fireRate) return;gameState.player.lastShot = now;const angle = Math.atan2(mouse.y - gameState.player.y, mouse.x - gameState.player.x);if (gameState.player.currentWeapon === WEAPONS.SHOTGUN) {if (gameState.player.ammo > 0) {gameState.player.ammo--;for (let i = 0; i < gameState.player.currentWeapon.pellets; i++) {const spreadAngle = angle + (Math.random() - 0.5) * gameState.player.currentWeapon.spread;createBullet(spreadAngle);}}} else {if (gameState.player.ammo > 0) {gameState.player.ammo--;if (gameState.doubleTap.used) {const spread = 0.1;createBullet(angle + spread / 2);createBullet(angle - spread / 2);} else {createBullet(angle);}}}}function createBullet(angle) {const weapon = gameState.player.currentWeapon;gameState.bullets.push({x: gameState.player.x,y: gameState.player.y,dx: Math.cos(angle) * weapon.bulletSpeed,dy: Math.sin(angle) * weapon.bulletSpeed,size: weapon.bulletSize,damage: weapon.damage,color: weapon.color});}function checkCollisionWithWalls(x, y, size) {for (let wall of mapConfig.walls) {if (x + size > wall.x && x - size < wall.x + wall.width && y + size > wall.y && y - size < wall.y + wall.height) {return true;}}return false;}function getRandomSpawnPoint() {return mapConfig.spawnPoints[Math.floor(Math.random() * mapConfig.spawnPoints.length)];}function spawnZombies() {if (selectedMap === 'MULTIPLAYER' && !room.party.client.host) {return;}const zombieCount = 5 + Math.floor(gameState.wave * 1.5);for (let i = 0; i < zombieCount; i++) {const spawnPoint = getRandomSpawnPoint();gameState.zombies.push({x: spawnPoint.x,y: spawnPoint.y,size: 30,speed: 1 + Math.random() + (gameState.wave * 0.1)});}if (selectedMap === 'MULTIPLAYER') {syncZombies();}}function updatePlayer() {let newX = gameState.player.x;let newY = gameState.player.y;if (keys["w"] || keys["ArrowUp"]) newY -= gameState.player.speed;if (keys["s"] || keys["ArrowDown"]) newY += gameState.player.speed;if (keys["a"] || keys["ArrowLeft"]) newX -= gameState.player.speed;if (keys["d"] || keys["ArrowRight"]) newX += gameState.player.speed;if (!checkCollisionWithWalls(newX, newY, gameState.player.size)) {gameState.player.x = Math.max(gameState.player.size, Math.min(gameState.worldWidth - gameState.player.size, newX));gameState.player.y = Math.max(gameState.player.size, Math.min(gameState.worldHeight - gameState.player.size, newY));}}function updateZombies() {if (selectedMap === 'MULTIPLAYER' && !room.party.client.host) {return;}for (let zombie of gameState.zombies) {const angle = Math.atan2(gameState.player.y - zombie.y, gameState.player.x - zombie.x);let newX = zombie.x + Math.cos(angle) * zombie.speed;let newY = zombie.y + Math.sin(angle) * zombie.speed;if (!checkCollisionWithWalls(newX, newY, zombie.size)) {zombie.x = newX;zombie.y = newY;} else {if (!checkCollisionWithWalls(zombie.x + Math.cos(angle) * zombie.speed, zombie.y, zombie.size)) {zombie.x += Math.cos(angle) * zombie.speed;} else if (!checkCollisionWithWalls(zombie.x, zombie.y + Math.sin(angle) * zombie.speed, zombie.size)) {zombie.y += Math.sin(angle) * zombie.speed;} }const dx = gameState.player.x - zombie.x;const dy = gameState.player.y - zombie.y;const distance = Math.sqrt(dx * dx + dy * dy);if (distance < gameState.player.size + zombie.size) {gameState.player.health -= 1;if (gameState.player.health <= 0) {gameOver();}}}if (selectedMap === 'MULTIPLAYER') {syncZombies();}}function updateMysteryBoxPrompt() {const dx = gameState.player.x - gameState.mysteryBox.x;const dy = gameState.player.y - gameState.mysteryBox.y;const distance = Math.sqrt(dx * dx + dy * dx);const prompt = document.getElementById("mysteryBoxPrompt");if (distance < 100 && !gameState.mysteryBox.isOpen) {prompt.style.display = "block";} else {prompt.style.display = "none";}}function updateJuggernogPrompt() {const dx = gameState.player.x - gameState.juggernog.x;const dy = gameState.player.y - gameState.juggernog.y;const distance = Math.sqrt(dx * dx + dy * dy);const prompt = document.getElementById("juggernogPrompt");if (distance < 100 && !gameState.juggernog.used) {prompt.style.display = "block";} else {prompt.style.display = "none";}}function updateDoubleTapPrompt() {const dx = gameState.player.x - gameState.doubleTap.x;const dy = gameState.player.y - gameState.doubleTap.y;const distance = Math.sqrt(dx * dx + dy * dy);const prompt = document.getElementById("doubleTapPrompt");if (distance < 100 && !gameState.doubleTap.used) {prompt.style.display = "block";} else {prompt.style.display = "none";}}function updateBullets() {for (let i = gameState.bullets.length - 1; i >= 0; i--) {const bullet = gameState.bullets[i];if (checkCollisionWithWalls(bullet.x, bullet.y, bullet.size)) {gameState.bullets.splice(i, 1);continue;}bullet.x += bullet.dx;bullet.y += bullet.dy;if (bullet.x < 0 || bullet.x > gameState.worldWidth || bullet.y < 0 || bullet.y > gameState.worldHeight) {gameState.bullets.splice(i, 1);continue;}for (let j = gameState.zombies.length - 1; j >= 0; j--) {const zombie = gameState.zombies[j];const dx = bullet.x - zombie.x;const dy = bullet.y - zombie.y;const distance = Math.sqrt(dx * dx + dy * dy);if (distance < zombie.size + bullet.size) {if (selectedMap === 'MULTIPLAYER') {broadcastZombieKill(j, 100);}gameState.zombies.splice(j, 1);gameState.bullets.splice(i, 1);gameState.score += 100;break;}}}}function getDistance(x1, y1, x2, y2) {const dx = x2 - x1;const dy = y2 - y1;return Math.sqrt(dx * dx + dy * dy);}function draw() {ctx.clearRect(0, 0, canvas.width, canvas.height);const cameraX = gameState.player.x - canvas.width / 2;const cameraY = gameState.player.y - canvas.height / 2;ctx.save();ctx.translate(-cameraX, -cameraY);ctx.fillStyle = "#1a1a1a";ctx.fillRect(0, 0, gameState.worldWidth, gameState.worldHeight);ctx.fillStyle = "#666666";for (let wall of mapConfig.walls) {ctx.fillRect(wall.x, wall.y, wall.width, wall.height);}const angle = Math.atan2(mouse.y - gameState.player.y, mouse.x - gameState.player.x);ctx.save();ctx.translate(gameState.player.x, gameState.player.y);ctx.rotate(angle);ctx.fillStyle = "#3a5a40";ctx.fillRect(-15, -12, 30, 24);ctx.fillStyle = "#c4a484";ctx.beginPath();ctx.arc(0, 0, 8, 0, Math.PI * 2);ctx.fill();ctx.fillStyle = "#463e3f";const gunLength = 25;ctx.fillRect(8, -4, gunLength, 8);ctx.fillRect(8, 4, 8, 10);ctx.restore();for (let zombie of gameState.zombies) {ctx.save();ctx.translate(zombie.x, zombie.y);const zombieAngle = Math.atan2(gameState.player.y - zombie.y, gameState.player.x - zombie.x);ctx.rotate(zombieAngle);ctx.fillStyle = "#2d4739";ctx.fillRect(-15, -12, 30, 24);ctx.fillStyle = "#435c4e";ctx.beginPath();ctx.arc(0, 0, 8, 0, Math.PI * 2);ctx.fill();ctx.fillStyle = "#2d4739";ctx.fillRect(-15, -8, 8, 5);ctx.fillRect(-15, 3, 8, 5);ctx.restore();}for (let bullet of gameState.bullets) {ctx.fillStyle = bullet.color;ctx.beginPath();ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);ctx.fill();}for (let door of gameState.doors) {if (!door.isOpen) {ctx.fillStyle = "#8b4513";ctx.fillRect(door.x, door.y, door.width, door.height);if (getDistance(gameState.player.x, gameState.player.y, door.x + door.width / 2, door.y + door.height / 2) < 100) {ctx.fillStyle = "#ffffff";ctx.font = "20px Arial";ctx.textAlign = "center";ctx.fillText(`Press E to Open (${door.cost} points)`, door.x + door.width / 2, door.y + door.height / 2 - 30);}}}if (!gameState.juggernog.used) {ctx.fillStyle = "#ff0000";ctx.fillRect(gameState.juggernog.x - gameState.juggernog.width / 2, gameState.juggernog.y - gameState.juggernog.height / 2, gameState.juggernog.width, gameState.juggernog.height);}if (!gameState.doubleTap.used) {ctx.fillStyle = "#ffa500";ctx.fillRect(gameState.doubleTap.x - gameState.doubleTap.width / 2, gameState.doubleTap.y - gameState.doubleTap.height / 2, gameState.doubleTap.width, gameState.doubleTap.height);}ctx.fillStyle = "#f5e6d3"; ctx.fillRect(gameState.mysteryBox.x, gameState.mysteryBox.y, gameState.mysteryBox.width, gameState.mysteryBox.height);ctx.fillStyle = "#ffbf00"; ctx.font = "30px Arial";ctx.textAlign = "center";ctx.textBaseline = "middle";ctx.fillText("?", gameState.mysteryBox.x + gameState.mysteryBox.width/2, gameState.mysteryBox.y + gameState.mysteryBox.height/2);if (gameState.mysteryBox.isOpen) {const elapsed = Date.now() - gameState.mysteryBox.animationStart;const animationProgress = Math.min(elapsed / 3000, 1);if (gameState.mysteryBox.currentWeapon) {ctx.fillStyle = gameState.mysteryBox.currentWeapon.color;ctx.beginPath();ctx.arc(gameState.mysteryBox.x + gameState.mysteryBox.width/2, gameState.mysteryBox.y - 20 - (40 * animationProgress), 10, 0, Math.PI * 2);ctx.fill();ctx.fillStyle = "#ffffff";ctx.font = "20px Arial";ctx.textAlign = "center";ctx.fillText(gameState.mysteryBox.currentWeapon.name, gameState.mysteryBox.x + gameState.mysteryBox.width/2, gameState.mysteryBox.y - 50 - (40 * animationProgress));}}if (currentMenu === 'playing' && selectedMap === 'MULTIPLAYER') {otherPlayers.forEach((player, clientId) => {ctx.save();ctx.translate(player.x, player.y);ctx.rotate(player.angle);ctx.fillStyle = "#3a5a40";ctx.fillRect(-15, -12, 30, 24);ctx.fillStyle = "#c4a484";ctx.beginPath();ctx.arc(0, 0, 8, 0, Math.PI * 2);ctx.fill();ctx.fillStyle = "#463e3f";ctx.fillRect(8, -4, gunLength, 8);ctx.fillRect(8, 4, 8, 10);ctx.rotate(-player.angle);ctx.fillStyle = "#ffffff";ctx.font = "14px Arial";ctx.textAlign = "center";ctx.fillText(player.username, 0, -30);ctx.restore();});}document.getElementById("score").textContent = `Score: ${gameState.score}`;document.getElementById("health").textContent = `Health: ${gameState.player.health}`;document.getElementById("waveCount").textContent = gameState.wave;document.getElementById("currentWeapon").textContent = `Current Weapon: ${gameState.player.currentWeapon.name} | Ammo: ${gameState.player.ammo}/${gameState.player.currentWeapon.maxAmmo}${gameState.player.isReloading ? ' (Reloading...)' : ''}`;updateMysteryBoxPrompt();updateJuggernogPrompt();updateDoubleTapPrompt();ctx.restore();}function gameOver() {gameState.gameOver = true;document.getElementById("gameOver").style.display = "block";document.getElementById("finalScore").textContent = gameState.score;document.getElementById("leaderboard").style.display = "block";updateLeaderboard();displayLeaderboard();}function resetGame() {Object.values(WEAPONS).forEach(weapon => {weapon.damage = weapon.damage / 2;weapon.fireRate = weapon.fireRate * 2;});gameState = {player: {x: 300,y: 300,size: 30,speed: 5,health: 100,currentWeapon: WEAPONS.PISTOL,lastShot: 0,ammo: WEAPONS.PISTOL.maxAmmo,isReloading: false, reloadStartTime: 0},zombies: [],bullets: [],doors: doorConfig.map(door => ({...door,isOpen: false})),wave: 1,score: 500,gameOver: false,mysteryBox: {x: 900,y: 700,width: 90,height: 40,isOpen: false,animationStart: 0,currentWeapon: null},juggernog: {x: 1700,y: 400,width: 40,height: 40,active: true,used: false},doubleTap: {x: 1200,y: 700,width: 40,height: 40,active: true,used: false},worldWidth: 3000,worldHeight: 3000};document.getElementById("gameOver").style.display = "none";document.getElementById("currentWeapon").textContent = "Current Weapon: Pistol | Ammo: 12/12";document.getElementById("leaderboard").style.display = "none";if (!gameStarted) {document.getElementById("mainMenu").style.display = "flex";}spawnZombies();}function updateLeaderboard() {room.store.update({id: 'leaderboard',dependencies: { username: room.party.client.username,wave: gameState.wave},updateFunction: (leaderboard) => {if (!leaderboard) leaderboard = [];const existingEntry = leaderboard.find(entry => entry.username === username);if (existingEntry) {if (wave > existingEntry.wave) {existingEntry.wave = wave;}} else {leaderboard.push({ username, wave });}leaderboard.sort((a, b) => b.wave - a.wave);return leaderboard.slice(0, 10);}});}function displayLeaderboard() {room.store.get('leaderboard').then(leaderboard => {if (!leaderboard) return;const entriesDiv = document.getElementById('leaderboardEntries');entriesDiv.innerHTML = leaderboard.map((entry, index) => `<div style="display: flex; justify-content: space-between; margin: 5px 0; ${entry.username === room.party.client.username ? 'color: #ff0000;' : ''}"><span>${index + 1}. ${entry.username}</span><span>Wave ${entry.wave}</span></div>`).join('');});}function broadcastPlayerState() {if (gameState.player && currentMenu === 'playing') {room.send({type: "playerUpdate",x: gameState.player.x,y: gameState.player.y,angle: Math.atan2(mouse.y - gameState.player.y, mouse.x - gameState.player.x),health: gameState.player.health,username: room.party.client.username});}}function gameLoop() {if (gameStarted && !gameState.gameOver) {updatePlayer();updateZombies();updateBullets();updateJuggernogPrompt();updateDoubleTapPrompt();if (currentMenu === 'playing' && selectedMap === 'MULTIPLAYER') {broadcastPlayerState();}if (gameState.zombies.length === 0) {gameState.wave++;spawnZombies();}}draw();requestAnimationFrame(gameLoop);}window.addEventListener("resize", resizeCanvas);spawnZombies();gameLoop();room.onmessage = (event) => {const data = event.data;switch (data.type) {case "playerUpdate":if (data.clientId !== room.party.client.id) {otherPlayers.set(data.clientId,{x: data.x,y: data.y,angle: data.angle,health: data.health,username: data.username});}break;case "disconnected":otherPlayers.delete(data.clientId);break;case "zombieSync":if (selectedMap === 'MULTIPLAYER' && !room.party.client.host) {gameState.zombies = data.zombies;gameState.wave = data.wave;}break;case "zombieKilled":if (selectedMap === 'MULTIPLAYER') {gameState.zombies.splice(data.index, 1);gameState.score += Math.floor(data.score / otherPlayers.size + 1);}}};document.getElementById("restartButton").addEventListener("click", resetGame);</script></body></html>